@if (mergedOptions.showFilter) {
  <mat-form-field>
    <mat-label>{{mergedOptions.filterOptions?.label || 'Filter'}}</mat-label>
    <input matInput (keyup)="applyFilter($event)" [placeholder]="mergedOptions.filterOptions?.placeholder || ''" #input>
  </mat-form-field>
  }
  
  
  <div class="mat-elevation-z8">
    <table mat-table 
          [dataSource]="dataSource" matSort 
          [matSortActive]="mergedOptions.sorterOptions?.defaultSortColumn || ''" 
          [matSortDirection]="mergedOptions.sorterOptions?.defaultSortDirection || 'asc'" 
          [matSortDisabled]="!mergedOptions.showSorter"
          [ngStyle]="mergedOptions.tableStyles || {}"
    >
  
      @for (column of columnMappings; track $index) {
      <ng-container [matColumnDef]="column.key">
        <th [ngStyle]="column?.headerCellStyles || {}" mat-header-cell *matHeaderCellDef mat-sort-header>{{column.label}}</th>
        <td [ngStyle]="column?.dataCellStyles || {}" mat-cell *matCellDef="let row" 
            [matTooltip]="getTooltipText(column, row)"
            [matTooltipDisabled]="getTooltipText(column, row) === ''"
        >
          @if (column?.component; as component) {
            <ng-container *ngComponentOutlet="component; inputs: getComponentInputs(column, row)"></ng-container>
          } @else if (column?.transformer) {
            {{column.transformer!(row[column.key])}}
          } @else {
            {{row[column.key]}}
          }
        </td>
      </ng-container>
      }
  
      @if (mergedOptions.showActions || mergedOptions.showTableActions) {
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="action-column">
            @if (mergedOptions.showTableActions) {
              <button mat-icon-button [matMenuTriggerFor]="tableMenu" [ngStyle]="mergedOptions.tableActionOptions?.buttonStyles || {}"><mat-icon>more_vert</mat-icon></button>
              <mat-menu #tableMenu="matMenu">
                @for (action of mergedOptions.tableActionOptions?.actions; track $index) {
                  @if (action.divider) {
                    <mat-divider></mat-divider>
                  } @else {
                    <button mat-menu-item (click)="action.fxn!()">
                      @if (action.icon) {
                        <mat-icon>{{action.icon}}</mat-icon>
                      }
                      <span>{{action.label}}</span>
                    </button>
                  }
                }
              </mat-menu>
            }
          </th>
          <td mat-cell *matCellDef="let row" class="action-column">
            @if (mergedOptions.showActions) {
              <button mat-icon-button [matMenuTriggerFor]="menu" [ngStyle]="mergedOptions.actionOptions?.buttonStyles || {}"><mat-icon>more_vert</mat-icon></button>
              <mat-menu #menu="matMenu">
                @for (action of mergedOptions.actionOptions?.actions; track $index) {
                  @if (action.divider) {
                    <mat-divider></mat-divider>
                  } @else {
                    <button mat-menu-item (click)="action.fxn!(row)">
                      @if (action.icon) {
                        <mat-icon>{{action.icon}}</mat-icon>
                      }
                      <span>{{action.label}}</span>
                    </button>
                  }
                }
              </mat-menu>
            }
          </td>
        </ng-container>
      }
  
      <tr mat-header-row *matHeaderRowDef="generateDisplayColumns()"></tr>
      <tr mat-row *matRowDef="let row; columns: generateDisplayColumns();"></tr>
  
      <!-- Row shown when there is no matching data. -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="generateDisplayColumns().length">
          @if (mergedOptions.noTableRow && !dataSource.filter) {
            <ng-container *ngComponentOutlet="mergedOptions.noTableRow"></ng-container>
          } @else if (mergedOptions.showFilter) {
            <p style="text-align: center;">No data matching the filter {{dataSource.filter ? '"' + dataSource.filter+ '"' : ''}}</p>
          } @else {
            <p style="text-align: center;">No data found</p>
          }
        </td>
      </tr>
    </table>
  </div>
  @if (mergedOptions.showPaginator) {
    <mat-paginator [pageSizeOptions]="mergedOptions.paginatorOptions?.pageSizeOptions || [5, 10, 25, 100]" aria-label="Select page of users"></mat-paginator>
  }